<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSEåŒ–å­¸å¾é€”ï¼šå…ƒç´ ç…‰é‡‘å¸«</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .progress-bar {
            transition: width 0.3s ease-in-out;
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- éŠæˆ²å®¹å™¨ -->
    <div id="game-container">
        <!-- æ¨™é¡Œ -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-700 text-white p-6 shadow-lg">
            <div class="max-w-4xl mx-auto text-center">
                <h1 class="text-4xl font-bold mb-2">ğŸ§ª DSEåŒ–å­¸å¾é€”ï¼šå…ƒç´ ç…‰é‡‘å¸«</h1>
                <p class="text-blue-100">èåˆé¦™æ¸¯DSEåŒ–å­¸èª²ç¨‹èˆ‡è§’è‰²æ‰®æ¼”éŠæˆ²çš„æ²‰æµ¸å¼å­¸ç¿’é«”é©—</p>
            </div>
        </div>

        <!-- ä¸»è¦å…§å®¹å€ -->
        <div class="max-w-4xl mx-auto p-6">
            <!-- è¨Šæ¯æç¤º -->
            <div id="message-container" class="hidden mb-4 p-4 bg-green-100 border border-green-200 text-green-800 rounded-lg"></div>

            <!-- ä¸»é¸å–® -->
            <div id="main-view" class="animate-fade-in">
                <!-- ç©å®¶ç‹€æ…‹å¡ç‰‡ -->
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-lg shadow-lg mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h2 id="player-name" class="text-2xl font-bold">è¦‹ç¿’åŒ–å­¸å®¶</h2>
                            <p id="player-title" class="text-blue-100">åŒ–å­¸å­¸å¾’</p>
                        </div>
                        <div class="text-right">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-xl">ğŸ‘‘</span>
                                <span id="player-level" class="text-xl font-bold">ç­‰ç´š 1</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-lg">ğŸª™</span>
                                <span id="player-coins">50 é‡‘å¹£</span>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div class="text-center">
                            <div class="flex items-center justify-center gap-1 mb-1">
                                <span>âš”ï¸</span>
                                <span class="font-medium">æ”»æ“ŠåŠ›</span>
                            </div>
                            <span id="player-attack" class="text-lg font-bold">10</span>
                        </div>
                        <div class="text-center">
                            <div class="flex items-center justify-center gap-1 mb-1">
                                <span>ğŸ›¡ï¸</span>
                                <span class="font-medium">é˜²ç¦¦åŠ›</span>
                            </div>
                            <span id="player-defense" class="text-lg font-bold">5</span>
                        </div>
                        <div class="text-center">
                            <div class="flex items-center justify-center gap-1 mb-1">
                                <span>ğŸ¯</span>
                                <span class="font-medium">ç²¾åº¦</span>
                            </div>
                            <span id="player-accuracy" class="text-lg font-bold">60%</span>
                        </div>
                    </div>

                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span>ç¶“é©—å€¼</span>
                            <span id="exp-display">0/100</span>
                        </div>
                        <div class="w-full bg-white/20 rounded-full h-2">
                            <div id="exp-bar" class="bg-yellow-400 h-2 rounded-full progress-bar" style="width: 0%"></div>
                        </div>
                    </div>

                    <div id="accuracy-display" class="mt-4 text-center text-blue-100 hidden">
                        ç­”é¡Œæº–ç¢ºç‡: <span id="accuracy-rate">0%</span> (<span id="correct-total">0/0</span>)
                    </div>
                </div>

                <!-- ä¸»é¸å–®æŒ‰éˆ• -->
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="showTopics()" class="flex items-center justify-between p-4 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors card-hover">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">ğŸ“š</span>
                            <span class="font-medium">èª²é¡ŒæŒ‘æˆ°</span>
                        </div>
                        <span class="text-xl">â¤</span>
                    </button>

                    <button onclick="showBosses()" class="flex items-center justify-between p-4 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors card-hover">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">ğŸ‘¹</span>
                            <span class="font-medium">é­”ç‹æŒ‘æˆ°</span>
                        </div>
                        <span class="text-xl">â¤</span>
                    </button>

                    <button onclick="showShop()" class="flex items-center justify-between p-4 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-colors card-hover">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">ğŸ›’</span>
                            <span class="font-medium">è£å‚™å•†åº—</span>
                              </div>
                        <span class="text-xl">â¤</span>
                    </button>
                        
                     <button onclick="showAchievements()" class="flex items-center justify-between p-4 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg transition-colors card-hover">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">ğŸ†</span>
                            <span class="font-medium">æˆå°±ç³»çµ±</span>
                              </div>
                        <span class="text-xl">â¤</span>
                    </button>
                   
                            <button onclick="showSkillTree()" class="flex items-center justify-between p-4 bg-green-400 hover:bg-green-500 text-white rounded-lg transition-colors card-hover">
                        <div class="flex items-center gap-3">
                         <span class="text-2xl">ğŸŒ³</span>
                         <span class="font-medium">æŠ€èƒ½æ¨¹</span>
                        </div>
                         <span class="text-xl">â¤</span>
                    </button>

                    <button onclick="showReport()" class="flex items-center justify-between p-4 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors card-hover">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">ğŸ“Š</span>
                            <span class="font-medium">å­¸ç¿’å ±å‘Š</span>
                        </div>
                        <span class="text-xl">â¤</span>
                    </button>

                    <button onclick="saveGame()" class="flex items-center justify-between p-4 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors card-hover">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">ğŸ’¾</span>
                            <span class="font-medium">å„²å­˜éŠæˆ²</span>
                        </div>
                        <span class="text-xl">â¤</span>
                    </button>
                </div>
            </div>

            <!-- èª²é¡Œé¸å–® -->
            <div id="topics-view" class="hidden animate-fade-in">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold gradient-text">ğŸ¯ DSEåŒ–å­¸èª²é¡ŒæŒ‘æˆ°</h2>
                    <button onclick="showMain()" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors">è¿”å›ä¸»é¸å–®</button>
                </div>
                <div id="topics-grid" class="grid gap-4"></div>
            </div>

            <!-- æŒ‘æˆ°ç•Œé¢ -->
            <div id="challenge-view" class="hidden animate-fade-in">
                <div class="max-w-2xl mx-auto space-y-6">
                    <div class="flex items-center justify-between">
                        <h2 id="challenge-title" class="text-xl font-bold"></h2>
                        <span id="question-counter" class="text-sm text-gray-600"></span>
                    </div>

                    <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                        <div class="mb-4">
                            <div class="flex items-center gap-2 mb-2">
                                <span id="question-topic" class="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded"></span>
                                <span id="question-difficulty" class="text-sm bg-yellow-100 text-yellow-800 px-2 py-1 rounded"></span>
                            </div>
                            <h3 id="question-text" class="text-lg font-medium mb-4"></h3>
                        </div>

                        <div id="options-container" class="space-y-3 mb-6"></div>

                        <div id="result-container" class="hidden mb-4"></div>

                        <div class="flex justify-end">
                            <button id="submit-btn" onclick="submitAnswer()" class="px-6 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white rounded-lg transition-colors">æäº¤ç­”æ¡ˆ</button>
                        </div>
                    </div>
                </div>
            </div>
<!-- æ–°å¢æŠ€èƒ½æ¨¹è¦–åœ– -->
<div id="skill-tree-view" class="hidden animate-fade-in max-w-2xl mx-auto p-6">
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold gradient-text">ğŸŒ³ æŠ€èƒ½æ¨¹</h2>
        <button onclick="showMain()" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors">è¿”å›ä¸»é¸å–®</button>
    </div>
    <div id="skill-tree-grid" class="grid grid-cols-1 gap-4"></div>
    <div class="mt-4 text-right text-blue-800 text-lg font-bold">
        æŠ€èƒ½é»ï¼š<span id="player-skill-points"></span>
    </div>
</div>
            <!-- è£å‚™å•†åº— -->
            <div id="shop-view" class="hidden animate-fade-in">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold gradient-text">ğŸ›’ ç…‰é‡‘å¸«è£å‚™å•†åº—</h2>
                    <button onclick="showMain()" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors">è¿”å›ä¸»é¸å–®</button>
                </div>
                <div id="shop-grid" class="grid gap-4"></div>
            </div>

            <!-- æˆå°±ç³»çµ± -->
            <div id="achievements-view" class="hidden animate-fade-in">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h2 class="text-2xl font-bold gradient-text">ğŸ† æˆå°±ç³»çµ±</h2>
                        <p id="achievement-progress" class="text-gray-600">å·²è§£é–ï¼š0/7</p>
                    </div>
                    <button onclick="showMain()" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors">è¿”å›ä¸»é¸å–®</button>
                </div>
                <div id="achievements-grid" class="grid gap-4"></div>
            </div>

            <!-- å­¸ç¿’å ±å‘Š -->
            <div id="report-view" class="hidden animate-fade-in">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold gradient-text">ğŸ“Š å­¸ç¿’å ±å‘Š</h2>
                    <button onclick="showMain()" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors">è¿”å›ä¸»é¸å–®</button>
                </div>

                <!-- ç¸½é«”è¡¨ç¾ -->
                <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm mb-6">
                    <h3 class="text-lg font-medium mb-4">ğŸ“ˆ ç¸½é«”è¡¨ç¾</h3>
                    <div id="overall-stats" class="grid grid-cols-3 gap-4">
                        <div class="text-center">
                            <div id="total-questions" class="text-2xl font-bold text-blue-600">0</div>
                            <div class="text-sm text-gray-600">ç­”é¡Œç¸½æ•¸</div>
                        </div>
                        <div class="text-center">
                            <div id="correct-answers" class="text-2xl font-bold text-green-600">0</div>
                            <div class="text-sm text-gray-600">æ­£ç¢ºç­”æ•¸</div>
                        </div>
                        <div class="text-center">
                            <div id="accuracy-percentage" class="text-2xl font-bold text-purple-600">0%</div>
                            <div class="text-sm text-gray-600">æº–ç¢ºç‡</div>
                        </div>
                    </div>
                </div>

                <!-- èª²é¡Œå®Œæˆåº¦ -->
                <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                    <h3 class="text-lg font-medium mb-4">ğŸ“š èª²é¡Œå®Œæˆåº¦</h3>
                    <div id="topic-progress" class="space-y-3"></div>
                </div>
            </div>

            <!-- é­”ç‹æŒ‘æˆ° -->
<div id="bosses-view" class="hidden animate-fade-in">
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold gradient-text">ğŸ‘¹ çŸ¥è­˜é­”ç‹æŒ‘æˆ°</h2>
        <button onclick="showMain()" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors">è¿”å›ä¸»é¸å–®</button>
    </div>
    <div id="boss-list"></div>
</div>
            
<!-- é­”ç‹æŒ‘æˆ°ä»‹é¢ -->
<div id="boss-challenge-view" class="hidden animate-fade-in">
    <div class="max-w-2xl mx-auto space-y-6">
        <div class="flex items-center justify-between">
            <h2 id="boss-name" class="text-2xl font-bold"></h2>
            <span id="boss-hp-display" class="text-lg text-red-600"></span>
        </div>
        <p id="boss-description" class="text-gray-700 mb-4"></p>
        <div id="boss-question-block"></div>
        <div id="boss-result-block" class="hidden"></div>
        <div class="flex justify-end">
            <button id="boss-submit-btn" class="px-6 py-2 bg-blue-500 text-white rounded-lg transition-colors">æäº¤ç­”æ¡ˆ</button>
        </div>
    </div>
</div>

    <script>
        // éŠæˆ²æ•¸æ“š
        let gameData = {
            player: {
                name: "è¦‹ç¿’åŒ–å­¸å®¶",
                level: 1,
                exp: 0,
                exp_to_next: 100,
                coins: 50,
                attack: 10,
                defense: 5,
                accuracy: 60,
                skill_points: 0,
                title: "åŒ–å­¸å­¸å¾’",
                skills: {
  "ç†è«–åŒ–å­¸": { unlocked: false, desc: "æå‡ç†è«–é¡Œå¾—åˆ† +5%", cost: 1 },
  "å¯¦é©—æŠ€å·§": { unlocked: false, desc: "æ»´å®šæº–ç¢ºåº¦ +5%", cost: 1 },
  "ç„¡æ©ŸåŒ–å­¸": { unlocked: false, desc: "æ°§åŒ–é‚„åŸé¡Œç›®æ­£ç¢ºç‡ +5%", cost: 2 }
},

                equipment: {},
                achievements: [],
                topics_completed: [],
                total_questions: 0,
                correct_answers: 0
            },
            topics: {
                "1": { name: "åœ°çƒè³‡æº", icon: "ğŸŒ", progress: 0, total: 5 },
                "2": { name: "å¾®è§€ä¸–ç•Œ", icon: "âš›ï¸", progress: 0, total: 5 },
                "3": { name: "é‡‘å±¬", icon: "ğŸ’", progress: 0, total: 5 },
                "4": { name: "é…¸é¹¼é¹½", icon: "ğŸ§ª", progress: 0, total: 5 },
                "5": { name: "åŒ–çŸ³ç‡ƒæ–™", icon: "â›½", progress: 0, total: 5 },
                "6": { name: "æ°§åŒ–é‚„åŸåæ‡‰", icon: "ğŸ”‹", progress: 0, total: 5 },
                "7": { name: "åŒ–å­¸åæ‡‰èˆ‡èƒ½é‡", icon: "âš¡", progress: 0, total: 5 },
                "8": { name: "åæ‡‰é€Ÿç‡èˆ‡å¹³è¡¡", icon: "âš–ï¸", progress: 0, total: 5 },
                "9": { name: "åŒ–å­¸ä¸–ç•Œä¸­çš„è¦å¾‹", icon: "ğŸ“Š", progress: 0, total: 5 }
            },
            achievements: {
                "é›»è§£å¤§å¸«": { description: "å®Œæˆ10å€‹é›»è§£ç›¸é—œé¡Œç›®", reward: 50, unlocked: false },
                "è¨ˆç®—é”äºº": { description: "é€£çºŒ10é¡Œè¨ˆç®—å…¨å°", reward: 100, unlocked: false },
                "å¯¦é©—é›¶å¤±èª¤": { description: "å®Œæˆæ‰€æœ‰å¯¦é©—æ¨¡æ“¬ç„¡éŒ¯èª¤", reward: 200, unlocked: false },
                "ç™¾é¡Œæ–¬": { description: "å›ç­”100é“é¡Œç›®", reward: 150, unlocked: false },
                "çŸ¥è­˜æ”¶é›†è€…": { description: "å®Œæˆ5å€‹èª²é¡Œ", reward: 300, unlocked: false },
                "é­”ç‹çµ‚çµè€…": { description: "æ“Šæ•—æ‰€æœ‰çŸ¥è­˜é­”ç‹", reward: 500, unlocked: false },
                "å®Œç¾ä¸»ç¾©è€…": { description: "ç­”é¡Œæº–ç¢ºç‡é”åˆ°90%", reward: 250, unlocked: false }
            }
        };

        // é¡Œåº«
        const questionBank = {
            "1": [
                {
                    question: "éµç¤¦çŸ³ä¸»è¦ç”¨å“ªç¨®æ–¹æ³•æå–éµï¼Ÿ",
                    options: ["A. é›»è§£", "B. ç¢³é‚„åŸ", "C. ç†±åˆ†è§£", "D. ç‰©ç†åˆ†é›¢"],
                    answer: "B",
                    explanation: "éµç¤¦çŸ³é€šå¸¸ä½¿ç”¨ç¢³é‚„åŸæ³•æå–éµï¼Œåœ¨é«˜æº«ä¸‹ç”¨ä¸€æ°§åŒ–ç¢³é‚„åŸæ°§åŒ–éµã€‚",
                    topic: "é‡‘å±¬æå–",
                    difficulty: 2
                },
                {
                    question: "ä»¥ä¸‹å“ªç¨®æ°£é«”æœƒå°è‡´æº«å®¤æ•ˆæ‡‰ï¼Ÿ",
                    options: ["A. æ°§æ°£", "B. æ°®æ°£", "C. äºŒæ°§åŒ–ç¢³", "D. æ°«æ°£"],
                    answer: "C",
                    explanation: "äºŒæ°§åŒ–ç¢³æ˜¯ä¸»è¦çš„æº«å®¤æ°£é«”ä¹‹ä¸€ï¼Œèƒ½å¸æ”¶åœ°é¢è¼»å°„çš„ç´…å¤–ç·šã€‚",
                    topic: "ç’°å¢ƒåŒ–å­¸",
                    difficulty: 1
                },
                {
                    question: "çŸ³ç°çŸ³çš„ä¸»è¦æˆåˆ†æ˜¯ä»€éº¼ï¼Ÿ",
                    options: ["A. CaO", "B. CaCOâ‚ƒ", "C. Ca(OH)â‚‚", "D. CaSOâ‚„"],
                    answer: "B",
                    explanation: "çŸ³ç°çŸ³çš„ä¸»è¦æˆåˆ†æ˜¯ç¢³é…¸éˆ£(CaCOâ‚ƒ)ã€‚",
                    topic: "ç¤¦ç‰©",
                    difficulty: 1
                },
                {
                    question: "ç…¤ç‚­ç‡ƒç‡’æœƒç”¢ç”Ÿå“ªç¨®æœ‰å®³æ°£é«”ï¼Ÿ",
                    options: ["A. Oâ‚‚", "B. Nâ‚‚", "C. SOâ‚‚", "D. Hâ‚‚"],
                    answer: "C",
                    explanation: "ç…¤ç‚­å«æœ‰ç¡«åŒ–åˆç‰©ï¼Œç‡ƒç‡’æ™‚æœƒç”¢ç”ŸäºŒæ°§åŒ–ç¡«ï¼Œå°è‡´é…¸é›¨ã€‚",
                    topic: "ç‡ƒæ–™åŒ–å­¸",
                    difficulty: 2
                },
                {
                    question: "æµ·æ°´ä¸­å«é‡æœ€å¤šçš„é¹½é¡æ˜¯ï¼Ÿ",
                    options: ["A. NaCl", "B. MgClâ‚‚", "C. CaClâ‚‚", "D. KCl"],
                    answer: "A",
                    explanation: "æµ·æ°´ä¸­å«é‡æœ€å¤šçš„é¹½é¡æ˜¯æ°¯åŒ–éˆ‰(NaCl)ï¼Œç´„ä½”ç¸½é¹½åˆ†çš„77%ã€‚",
                    topic: "å¤©ç„¶è³‡æº",
                    difficulty: 2
                }
            ],
            "2": [
                {
                    question: "åŸå­æ ¸ç”±ä»€éº¼ç²’å­çµ„æˆï¼Ÿ",
                    options: ["A. è³ªå­å’Œé›»å­", "B. è³ªå­å’Œä¸­å­", "C. ä¸­å­å’Œé›»å­", "D. åªæœ‰è³ªå­"],
                    answer: "B",
                    explanation: "åŸå­æ ¸ç”±è³ªå­å’Œä¸­å­çµ„æˆï¼Œé›»å­åœ¨æ ¸å¤–é‹å‹•ã€‚",
                    topic: "åŸå­çµæ§‹",
                    difficulty: 1
                },
                {
                    question: "ç¢³-12åŸå­çš„è³ªé‡æ•¸æ˜¯å¤šå°‘ï¼Ÿ",
                    options: ["A. 6", "B. 12", "C. 18", "D. 24"],
                    answer: "B",
                    explanation: "è³ªé‡æ•¸ç­‰æ–¼è³ªå­æ•¸åŠ ä¸­å­æ•¸ï¼Œç¢³-12æœ‰6å€‹è³ªå­å’Œ6å€‹ä¸­å­ã€‚",
                    topic: "åŸå­è³ªé‡",
                    difficulty: 2
                },
                {
                    question: "é›»å­åœ¨åŸå­ä¸­çš„æ’åˆ—éµå¾ªä»€éº¼åŸç†ï¼Ÿ",
                    options: ["A. èƒ½é‡æœ€é«˜åŸç†", "B. èƒ½é‡æœ€ä½åŸç†", "C. éš¨æ©Ÿæ’åˆ—", "D. å¯†åº¦æœ€å¤§åŸç†"],
                    answer: "B",
                    explanation: "é›»å­åœ¨åŸå­ä¸­æœƒå„ªå…ˆä½”æ“šèƒ½é‡è¼ƒä½çš„è»ŒåŸŸï¼Œé€™æ˜¯èƒ½é‡æœ€ä½åŸç†ã€‚",
                    topic: "é›»å­çµæ§‹",
                    difficulty: 2
                },
                {
                    question: "åŒä½ç´ æ˜¯æŒ‡å…·æœ‰ç›¸åŒä»€éº¼æ•¸ç›®çš„åŸå­ï¼Ÿ",
                    options: ["A. è³ªé‡æ•¸", "B. ä¸­å­æ•¸", "C. è³ªå­æ•¸", "D. é›»å­æ•¸"],
                    answer: "C",
                    explanation: "åŒä½ç´ æ˜¯æŒ‡è³ªå­æ•¸ç›¸åŒä½†ä¸­å­æ•¸ä¸åŒçš„åŸå­ã€‚",
                    topic: "åŒä½ç´ ",
                    difficulty: 2
                },
                {
                    question: "åŸå­çš„åŒ–å­¸æ€§è³ªä¸»è¦ç”±ä»€éº¼æ±ºå®šï¼Ÿ",
                    options: ["A. è³ªå­æ•¸", "B. ä¸­å­æ•¸", "C. æœ€å¤–å±¤é›»å­", "D. åŸå­è³ªé‡"],
                    answer: "C",
                    explanation: "åŸå­çš„åŒ–å­¸æ€§è³ªä¸»è¦ç”±æœ€å¤–å±¤é›»å­æ•¸æ±ºå®šã€‚",
                    topic: "åŒ–å­¸æ€§è³ª",
                    difficulty: 2
                }
            ],
            "3": [
                {
                    question: "é‡‘å±¬å…·æœ‰å…‰æ¾¤æ˜¯å› ç‚ºï¼Ÿ",
                    options: ["A. é›»å­é›²åå°„å…‰ç·š", "B. åŸå­æŒ¯å‹•", "C. é›¢å­æ’åˆ—", "D. åŒ–å­¸åæ‡‰"],
                    answer: "A",
                    explanation: "é‡‘å±¬çš„è‡ªç”±é›»å­èƒ½æœ‰æ•ˆåå°„å…‰ç·šï¼Œå› æ­¤å…·æœ‰é‡‘å±¬å…‰æ¾¤ã€‚",
                    topic: "é‡‘å±¬æ€§è³ª",
                    difficulty: 2
                },
                {
                    question: "é‹åœ¨ç©ºæ°£ä¸­ä¸æ˜“è…è•æ˜¯å› ç‚ºï¼Ÿ",
                    options: ["A. é‹å¾ˆç©©å®š", "B. è¡¨é¢å½¢æˆæ°§åŒ–è†œ", "C. é‹ä¸æ´»æ½‘", "D. é‹ä¸å°é›»"],
                    answer: "B",
                    explanation: "é‹è¡¨é¢æœƒå½¢æˆç·»å¯†çš„æ°§åŒ–é‹è–„è†œï¼Œé˜»æ­¢é€²ä¸€æ­¥æ°§åŒ–ã€‚",
                    topic: "é‡‘å±¬è…è•",
                    difficulty: 2
                },
                {
                    question: "é‡‘å±¬çš„æ´»æ€§é †åºä¸­ï¼Œæœ€æ´»æ½‘çš„æ˜¯ï¼Ÿ",
                    options: ["A. éµ", "B. é‹…", "C. é‰€", "D. éŠ…"],
                    answer: "C",
                    explanation: "åœ¨é‡‘å±¬æ´»æ€§é †åºä¸­ï¼Œé‰€æ˜¯æœ€æ´»æ½‘çš„é‡‘å±¬ä¹‹ä¸€ã€‚",
                    topic: "é‡‘å±¬æ´»æ€§",
                    difficulty: 2
                },
                {
                    question: "åˆé‡‘æ¯”ç´”é‡‘å±¬æ›´å …ç¡¬æ˜¯å› ç‚ºï¼Ÿ",
                    options: ["A. è³ªé‡æ›´å¤§", "B. åŸå­æ’åˆ—è¢«æ‰“äº‚", "C. å¯†åº¦æ›´é«˜", "D. æº«åº¦æ›´é«˜"],
                    answer: "B",
                    explanation: "åˆé‡‘ä¸­ä¸åŒå¤§å°çš„åŸå­æ‰“äº‚äº†é‡‘å±¬çš„è¦å‰‡æ’åˆ—ï¼Œä½¿å…¶æ›´å …ç¡¬ã€‚",
                    topic: "åˆé‡‘",
                    difficulty: 2
                },
                {
                    question: "é›»éçš„åŸç†æ˜¯ï¼Ÿ",
                    options: ["A. ç‰©ç†æ²‰ç©", "B. é›»è§£", "C. åŒ–å­¸åæ‡‰", "D. ç†±è™•ç†"],
                    answer: "B",
                    explanation: "é›»éæ˜¯åˆ©ç”¨é›»è§£åŸç†ï¼Œåœ¨é‡‘å±¬è¡¨é¢æ²‰ç©å¦ä¸€ç¨®é‡‘å±¬ã€‚",
                    topic: "é›»é",
                    difficulty: 2
                }
            ],
            "4": [
                {
                    question: "ä»¥ä¸‹å“ªç¨®ç‰©è³ªæ˜¯å¼·é…¸ï¼Ÿ",
                    options: ["A. é†‹é…¸", "B. ç¡«é…¸", "C. ç¢³é…¸", "D. ç¡¼é…¸"],
                    answer: "B",
                    explanation: "ç¡«é…¸æ˜¯å¸¸è¦‹çš„å¼·é…¸ï¼Œåœ¨æ°´ä¸­å®Œå…¨é›»é›¢ã€‚",
                    topic: "é…¸çš„å¼·åº¦",
                    difficulty: 1
                },
                {
                    question: "pHå€¼ç‚º7çš„æº¶æ¶²æ˜¯ï¼Ÿ",
                    options: ["A. é…¸æ€§", "B. é¹¼æ€§", "C. ä¸­æ€§", "D. ç„¡æ³•ç¢ºå®š"],
                    answer: "C",
                    explanation: "pH=7è¡¨ç¤º[Hâº]=[OHâ»]ï¼Œæº¶æ¶²å‘ˆä¸­æ€§ã€‚",
                    topic: "pHå€¼",
                    difficulty: 1
                },
                {
                    question: "æ°«æ°§åŒ–éˆ‰çš„åŒ–å­¸å¼æ˜¯ï¼Ÿ",
                    options: ["A. NaOH", "B. Naâ‚‚O", "C. NaCl", "D. Naâ‚‚SOâ‚„"],
                    answer: "A",
                    explanation: "æ°«æ°§åŒ–éˆ‰çš„åŒ–å­¸å¼æ˜¯NaOHï¼Œæ˜¯å¸¸è¦‹çš„å¼·é¹¼ã€‚",
                    topic: "é¹¼é¡",
                    difficulty: 1
                },
                {
                    question: "é¹½é…¸èˆ‡å¤§ç†çŸ³åæ‡‰æœƒç”¢ç”Ÿä»€éº¼æ°£é«”ï¼Ÿ",
                    options: ["A. æ°«æ°£", "B. æ°§æ°£", "C. äºŒæ°§åŒ–ç¢³", "D. æ°®æ°£"],
                    answer: "C",
                    explanation: "é¹½é…¸èˆ‡ç¢³é…¸éˆ£(å¤§ç†çŸ³)åæ‡‰ç”¢ç”ŸäºŒæ°§åŒ–ç¢³æ°£é«”ã€‚",
                    topic: "é…¸é¹¼åæ‡‰",
                    difficulty: 2
                },
                {
                    question: "æ»´å®šå¯¦é©—ä¸­ï¼ŒæŒ‡ç¤ºåŠ‘çš„ä½œç”¨æ˜¯ï¼Ÿ",
                    options: ["A. åŠ é€Ÿåæ‡‰", "B. é¡¯ç¤ºçµ‚é»", "C. æä¾›æ°«é›¢å­", "D. ä¸­å’Œæº¶æ¶²"],
                    answer: "B",
                    explanation: "æŒ‡ç¤ºåŠ‘åœ¨æ»´å®šä¸­ç”¨ä¾†é¡¯ç¤ºåæ‡‰çš„çµ‚é»ã€‚",
                    topic: "æ»´å®š",
                    difficulty: 2
                }
            ]
        };

        // é­”ç‹é¡Œåº«ç¤ºä¾‹
const bosses = [
    {
        id: "boss1",
        name: "ç¡«ç£ºé­”ç‹",
        icon: "ğŸ‘¹",
        description: "èåˆé…¸é¹¼ã€é‡‘å±¬ã€ç’°å¢ƒåŒ–å­¸çš„çµ‚æ¥µè€ƒé©—ã€‚",
        hp: 3,
        questions: [
            {
                question: "ç¡«é…¸èˆ‡éµåæ‡‰å¾Œï¼Œç”¢ç‰©æ˜¯ï¼Ÿ",
                options: ["A. FeSOâ‚„ + Hâ‚‚", "B. Feâ‚‚(SOâ‚„)â‚ƒ + Hâ‚‚", "C. FeSOâ‚„ + SOâ‚‚ + Hâ‚‚O", "D. FeO + Hâ‚‚SOâ‚„"],
                answer: "A",
                explanation: "éµèˆ‡ç¨€ç¡«é…¸åæ‡‰ç”Ÿæˆç¡«é…¸äºéµå’Œæ°«æ°£ã€‚"
            },
            {
                question: "ä¸‹åˆ—ä½•è€…å±¬æ–¼æº«å®¤æ°£é«”ï¼Ÿ",
                options: ["A. Oâ‚‚", "B. COâ‚‚", "C. Nâ‚‚", "D. Hâ‚‚"],
                answer: "B",
                explanation: "COâ‚‚ï¼ˆäºŒæ°§åŒ–ç¢³ï¼‰æ˜¯ä¸»è¦çš„æº«å®¤æ°£é«”ä¹‹ä¸€ã€‚"
            },
            {
                question: "é‡‘å±¬è…è•çš„ä¸»è¦åŸå› æ˜¯ï¼Ÿ",
                options: ["A. é‡‘å±¬èˆ‡æ°´åæ‡‰", "B. é‡‘å±¬èˆ‡æ°§æ°£åæ‡‰", "C. é‡‘å±¬èˆ‡æ°«æ°£åæ‡‰", "D. é‡‘å±¬èˆ‡æ°¯æ°£åæ‡‰"],
                answer: "B",
                explanation: "é‡‘å±¬èˆ‡æ°§æ°£åæ‡‰å½¢æˆæ°§åŒ–å±¤ï¼Œå°è‡´è…è•ã€‚"
            }
        ],
        reward: { exp: 200, coins: 100, achievement: "é­”ç‹çµ‚çµè€…" }
    },
    {
    id: "boss2",
    name: "æ¨¡ç³Šä¹‹å½±",
    icon: "ğŸ‘»",
    description: "è€ƒé©—åŸºç¤çŸ¥è­˜èˆ‡ç´°å¿ƒå¯©é¡Œèƒ½åŠ›ã€‚",
    hp: 4,
    questions: [
        {
            question: "ä¸‹åˆ—å“ªé …æ˜¯å¼·é¹¼ï¼Ÿ",
            options: ["A. HCl", "B. NaOH", "C. H2SO4", "D. CH3COOH"],
            answer: "B",
            explanation: "NaOHï¼ˆæ°«æ°§åŒ–éˆ‰ï¼‰æ˜¯å¼·é¹¼ã€‚"
        },
        {
            question: "ä¸‹åˆ—å“ªå€‹ç‰©è³ªå±¬æ–¼é‡‘å±¬ï¼Ÿ",
            options: ["A. ç¡«", "B. æ°§", "C. é‹…", "D. æ°¯"],
            answer: "C",
            explanation: "é‹…å±¬æ–¼é‡‘å±¬å…ƒç´ ã€‚"
        },
        {
            question: "1æ‘©çˆ¾æ°´åˆ†å­å«æœ‰å¤šå°‘å€‹åˆ†å­ï¼Ÿ",
            options: ["A. 6.02Ã—10^23", "B. 1", "C. 18", "D. 1000"],
            answer: "A",
            explanation: "1æ‘©çˆ¾ä»»ä½•ç‰©è³ªéƒ½å«æœ‰é˜¿ä¼ä¼½å¾·ç¾…å¸¸æ•¸å€‹å¾®ç²’ã€‚"
        },
        {
            question: "ä¸‹åˆ—å“ªé …ç‚ºä¸­æ€§æº¶æ¶²çš„pHå€¼ï¼Ÿ",
            options: ["A. 5", "B. 7", "C. 9", "D. 3"],
            answer: "B",
            explanation: "pH=7ç‚ºä¸­æ€§ã€‚"
        }
    ],
    reward: { exp: 250, coins: 150, achievement: "" }
}
    // å¯ä»¥æŒçºŒæ–°å¢æ›´å¤šé­”ç‹
];

// Boss æŒ‘æˆ°ç‹€æ…‹
let currentBoss = null;
let bossQuestionIndex = 0;
let bossHP = 0;

// é¡¯ç¤º Boss åˆ—è¡¨
function renderBossList() {
    const container = document.getElementById('boss-list');
    container.innerHTML = bosses.map(boss => `
        <div class="mb-4 p-4 bg-white border rounded shadow flex items-center justify-between">
            <div>
                <span class="text-3xl mr-2">${boss.icon}</span>
                <b>${boss.name}</b>
                <p class="text-gray-600">${boss.description}</p>
            </div>
            <button onclick="startBossChallenge('${boss.id}')" class="bg-red-500 text-white px-4 py-2 rounded">æŒ‘æˆ°</button>
        </div>
    `).join('');
}

// è¦†å¯« showBosses
function showBosses() {
    hideAllViews();
    document.getElementById('bosses-view').classList.remove('hidden');
    renderBossList();
}

// å•Ÿå‹• Boss æŒ‘æˆ°
function startBossChallenge(bossId) {
    currentBoss = bosses.find(b => b.id === bossId);
    bossQuestionIndex = 0;
    bossHP = currentBoss.hp;
    hideAllViews();
    document.getElementById('boss-challenge-view').classList.remove('hidden');
    document.getElementById('boss-name').textContent = `${currentBoss.icon} ${currentBoss.name}`;
    document.getElementById('boss-description').textContent = currentBoss.description;
    updateBossHP();
    renderBossQuestion();
}

// é¡¯ç¤º Boss HP
function updateBossHP() {
    document.getElementById('boss-hp-display').textContent = `HP: ${bossHP}/${currentBoss.hp}`;
}

// é¡¯ç¤º Boss é¡Œç›®
function renderBossQuestion() {
    const q = currentBoss.questions[bossQuestionIndex];
    const block = document.getElementById('boss-question-block');
    block.innerHTML = `
        <div class="mb-2 font-medium">${q.question}</div>
        <div>
            ${q.options.map(opt => `
                <label class="block mb-2">
                    <input type="radio" name="boss-answer" value="${opt.charAt(0)}"> ${opt}
                </label>
            `).join('')}
        </div>
    `;
    document.getElementById('boss-result-block').classList.add('hidden');
    document.getElementById('boss-submit-btn').onclick = submitBossAnswer;
}

// æäº¤ Boss ç­”æ¡ˆ
function submitBossAnswer() {
    const q = currentBoss.questions[bossQuestionIndex];
    const selected = document.querySelector('input[name="boss-answer"]:checked');
    if (!selected) return;
    const isCorrect = selected.value === q.answer;

    // å›é¥‹
    const resultBlock = document.getElementById('boss-result-block');
    resultBlock.classList.remove('hidden');
    resultBlock.innerHTML = isCorrect 
        ? `<div class="text-green-700">âœ… æ­£ç¢ºï¼${q.explanation}</div>`
        : `<div class="text-red-700">âŒ éŒ¯èª¤ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ ${q.answer}ã€‚${q.explanation}</div>`;

    if (isCorrect) bossHP--;
    updateBossHP();

    // ä¸‹ä¸€é¡Œæˆ–çµç®—
    setTimeout(() => {
        bossQuestionIndex++;
        if (bossHP === 0) {
            finishBossChallenge(true);
        } else if (bossQuestionIndex >= currentBoss.questions.length) {
            finishBossChallenge(false);
        } else {
            renderBossQuestion();
        }
    }, 1200);
}

// çµç®— Boss æŒ‘æˆ°
function finishBossChallenge(victory) {
    const reward = currentBoss.reward;
    let msg = '';
    if (victory) {
        gameData.player.exp += reward.exp;
        gameData.player.coins += reward.coins;
        if (gameData.achievements[reward.achievement]) {
            gameData.achievements[reward.achievement].unlocked = true;
        }
        msg = `ğŸ‰ ä½ æ“Šæ•—äº†${currentBoss.name}ï¼ç²å¾—${reward.exp}ç¶“é©—å’Œ${reward.coins}é‡‘å¹£ã€‚`;
    } else {
        msg = 'ğŸ˜¢ æŒ‘æˆ°å¤±æ•—ï¼Œä¸‹æ¬¡å†ä¾†ï¼';
    }
    showMessage(msg);
    checkLevelUp();
    checkAchievements();
    showBosses();
}
        
        // è£å‚™å•†åº—
        const equipmentShop = {
            "ç²¾å¯†æ»´å®šç®¡": { price: 100, attack: 8, accuracy: 5, description: "+8æ”»æ“ŠåŠ›, +5%å¯¦é©—ç²¾åº¦" },
            "é«˜æ•ˆæœ¬ç”Ÿç‡ˆ": { price: 150, attack: 12, description: "+12æ”»æ“ŠåŠ›, åŠ é€Ÿåæ‡‰ä»»å‹™" },
            "é›»è§£å¤§å¸«æ‰‹å¥—": { price: 200, attack: 15, defense: 10, description: "+15æ”»æ“ŠåŠ›, +10é˜²ç¦¦åŠ›" },
            "åŒ–å­¸å…¸ç±": { price: 120, defense: 10, accuracy: 8, description: "+10é˜²ç¦¦åŠ›, æå‡ç†è«–é¡Œå¾—åˆ†" },
            "è­·ç›®é¡": { price: 80, defense: 5, accuracy: 10, description: "+5é˜²ç¦¦åŠ›, +10%å¯¦é©—ç²¾åº¦" },
            "è¨ˆç®—ç¥å™¨": { price: 250, attack: 20, accuracy: 15, description: "+20æ”»æ“ŠåŠ›, +15%è¨ˆç®—æº–ç¢ºåº¦" },
            "é€Ÿè¨˜å·è»¸": { price: 120, description: "ç¸®çŸ­ç­”é¡Œæ™‚é–“ï¼Œç†è«–é¡Œç­”é¡Œé€Ÿåº¦+10%", special: "quick-answer" },
            "éˆæ„Ÿè—¥åŠ‘": { price: 200, description: "é‡åˆ°é›£é¡Œæ™‚å¯é¡¯ç¤ºæç¤º", special: "hint" }
        };

        // æŒ‘æˆ°ç›¸é—œè®Šæ•¸
        let currentChallenge = null;
        let challengeQuestions = [];
        let currentQuestion = 0;
        let selectedAnswer = '';
        let showResult = false;
        let challengeResults = { correct: 0, total: 0 };

        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            loadGame();
            updatePlayerDisplay();
            showMain();
        }

        // è¼‰å…¥éŠæˆ²æ•¸æ“š
        function loadGame() {
            const savedGame = localStorage.getItem('dse-chemistry-rpg');
            if (savedGame) {
                try {
                    const data = JSON.parse(savedGame);
                    gameData = { ...gameData, ...data };
                } catch (e) {
                    console.error('è¼‰å…¥éŠæˆ²å¤±æ•—:', e);
                }
            }
        }

        // å„²å­˜éŠæˆ²
        function saveGame() {
            const saveData = {
                ...gameData,
                lastSave: new Date().toISOString()
            };
            localStorage.setItem('dse-chemistry-rpg', JSON.stringify(saveData));
            showMessage('âœ… éŠæˆ²é€²åº¦å·²å„²å­˜ï¼');
        }

        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(message) {
            const container = document.getElementById('message-container');
            container.textContent = message;
            container.classList.remove('hidden');
            setTimeout(() => {
                container.classList.add('hidden');
            }, 3000);
        }

        // æ›´æ–°ç©å®¶é¡¯ç¤º
        function updatePlayerDisplay() {
            const player = gameData.player;
            document.getElementById('player-name').textContent = player.name;
            document.getElementById('player-title').textContent = player.title;
            document.getElementById('player-level').textContent = `ç­‰ç´š ${player.level}`;
            document.getElementById('player-coins').textContent = `${player.coins} é‡‘å¹£`;
            document.getElementById('player-attack').textContent = player.attack;
            document.getElementById('player-defense').textContent = player.defense;
            document.getElementById('player-accuracy').textContent = `${player.accuracy}%`;
            document.getElementById('exp-display').textContent = `${player.exp}/${player.exp_to_next}`;
            
            const expPercentage = (player.exp / player.exp_to_next) * 100;
            document.getElementById('exp-bar').style.width = `${expPercentage}%`;

            if (player.total_questions > 0) {
                const accuracy = ((player.correct_answers / player.total_questions) * 100).toFixed(1);
                document.getElementById('accuracy-rate').textContent = `${accuracy}%`;
                document.getElementById('correct-total').textContent = `${player.correct_answers}/${player.total_questions}`;
                document.getElementById('accuracy-display').classList.remove('hidden');
            }
        }

        // å‡ç´šæª¢æŸ¥
        function checkLevelUp() {
            let player = gameData.player;
            while (player.exp >= player.exp_to_next) {
                player.exp -= player.exp_to_next;
                player.level += 1;
                player.exp_to_next = Math.floor(player.exp_to_next * 1.5);
                player.attack += 5;
                player.defense += 3;
                player.accuracy += 2;
                player.skill_points += 1;

                // æ›´æ–°ç¨±è™Ÿ
                if (player.level >= 20) player.title = "å‚³å¥‡ç…‰é‡‘å¸«";
                else if (player.level >= 15) player.title = "å…ƒç´ æŒæ§è€…";
                else if (player.level >= 10) player.title = "å‚‘å‡ºåˆ†æè€…";
                else if (player.level >= 5) player.title = "åˆæ ¼å¯¦é©—å“¡";

                showMessage(`ğŸ‰ æ­å–œå‡ç´šåˆ° ${player.level} ç´šï¼ç²å¾—æŠ€èƒ½é» +1`);
            }
            updatePlayerDisplay();
        }

        // æª¢æŸ¥æˆå°±
        function checkAchievements() {
            const player = gameData.player;
            const achievements = gameData.achievements;
            let newUnlocked = [];

            // ç™¾é¡Œæ–¬
            if (player.total_questions >= 100 && !achievements['ç™¾é¡Œæ–¬'].unlocked) {
                achievements['ç™¾é¡Œæ–¬'].unlocked = true;
                newUnlocked.push('ç™¾é¡Œæ–¬');
            }

            // å®Œç¾ä¸»ç¾©è€…
            if (player.total_questions >= 20 && 
                (player.correct_answers / player.total_questions) >= 0.9 &&
                !achievements['å®Œç¾ä¸»ç¾©è€…'].unlocked) {
                achievements['å®Œç¾ä¸»ç¾©è€…'].unlocked = true;
                newUnlocked.push('å®Œç¾ä¸»ç¾©è€…');
            }

            // è™•ç†æ–°æˆå°±çå‹µ
            if (newUnlocked.length > 0) {
                let totalReward = 0;
                newUnlocked.forEach(achievement => {
                    totalReward += achievements[achievement].reward;
                });
                player.coins += totalReward;
                showMessage(`ğŸ† ç²å¾—æˆå°±ï¼š${newUnlocked.join('ã€')}ï¼çå‹µ ${totalReward} é‡‘å¹£`);
                updatePlayerDisplay();
            }
        }

        // è¦–åœ–åˆ‡æ›
        function hideAllViews() {
            const views = ['main-view', 'topics-view', 'challenge-view', 'shop-view', 'achievements-view', 'report-view', 'bosses-view'];
            views.forEach(view => {
                document.getElementById(view).classList.add('hidden');
            });
        }

        function showMain() {
            hideAllViews();
            document.getElementById('main-view').classList.remove('hidden');
            updatePlayerDisplay();
        }

        function showTopics() {
            hideAllViews();
            document.getElementById('topics-view').classList.remove('hidden');
            renderTopics();
        }

        function showBosses() {
            hideAllViews();
            document.getElementById('bosses-view').classList.remove('hidden');
            renderBossList();
        }

        function showShop() {
            hideAllViews();
            document.getElementById('shop-view').classList.remove('hidden');
            renderShop();
        }

        function showAchievements() {
            hideAllViews();
            document.getElementById('achievements-view').classList.remove('hidden');
            renderAchievements();
        }

        function showReport() {
            hideAllViews();
            document.getElementById('report-view').classList.remove('hidden');
            renderReport();
        }

        // æ¸²æŸ“èª²é¡Œ
        function renderTopics() {
            const grid = document.getElementById('topics-grid');
            grid.innerHTML = '';

            Object.entries(gameData.topics).forEach(([topicId, topic]) => {
                const progress = (topic.progress / topic.total) * 100;
                const isComplete = topic.progress >= topic.total;
                
                const topicCard = document.createElement('div');
                topicCard.className = 'bg-white border border-gray-200 rounded-lg p-4 shadow-sm card-hover';
                topicCard.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">${topic.icon}</span>
                            <div>
                                <h3 class="font-medium">${topic.name}</h3>
                                <p class="text-sm text-gray-600">
                                    é€²åº¦: ${topic.progress}/${topic.total}
                                    ${isComplete ? ' âœ…å·²å®Œæˆ' : ''}
                                </p>
                            </div>
                        </div>
                        <button onclick="startTopicChallenge('${topicId}')" 
                                ${!questionBank[topicId] ? 'disabled' : ''}
                                class="px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white rounded-lg transition-colors">
                            é–‹å§‹æŒ‘æˆ°
                        </button>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-600 h-2 rounded-full progress-bar" style="width: ${progress}%"></div>
                    </div>
                `;
                grid.appendChild(topicCard);
            });
        }

        // é–‹å§‹èª²é¡ŒæŒ‘æˆ°
        function startTopicChallenge(topicId) {
            const questions = questionBank[topicId] || [];
            if (questions.length === 0) {
                showMessage('âŒ è©²èª²é¡Œæš«æœªé–‹æ”¾');
                return;
            }

            challengeQuestions = questions;
            currentChallenge = topicId;
            currentQuestion = 0;
            selectedAnswer = '';
            showResult = false;
            challengeResults = { correct: 0, total: questions.length };

            hideAllViews();
            document.getElementById('challenge-view').classList.remove('hidden');
            displayQuestion();
        }

        // é¡¯ç¤ºé¡Œç›®
        function displayQuestion() {
            const question = challengeQuestions[currentQuestion];
            const topic = gameData.topics[currentChallenge];

            document.getElementById('challenge-title').textContent = `${topic.icon} ${topic.name}`;
            document.getElementById('question-counter').textContent = `${currentQuestion + 1}/${challengeQuestions.length}`;
            document.getElementById('question-topic').textContent = question.topic;
            document.getElementById('question-difficulty').textContent = `é›£åº¦: ${'â­'.repeat(question.difficulty)}`;
            document.getElementById('question-text').textContent = question.question;

            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('label');
                optionDiv.className = 'flex items-center space-x-3 cursor-pointer p-3 border border-gray-200 rounded-lg hover:bg-gray-50';
                optionDiv.innerHTML = `
                    <input type="radio" name="answer" value="${option.charAt(0)}" 
                           onchange="selectAnswer('${option.charAt(0)}')"
                           class="w-4 h-4 text-blue-600">
                    <span class="flex-1">${option}</span>
                `;
                optionsContainer.appendChild(optionDiv);
            });

            document.getElementById('result-container').classList.add('hidden');
            document.getElementById('submit-btn').textContent = 'æäº¤ç­”æ¡ˆ';
            document.getElementById('submit-btn').onclick = submitAnswer;
            document.getElementById('submit-btn').disabled = true;
        }

        // é¸æ“‡ç­”æ¡ˆ
        function selectAnswer(answer) {
            selectedAnswer = answer;
            document.getElementById('submit-btn').disabled = false;
        }

        // æäº¤ç­”æ¡ˆ
        function submitAnswer() {
            if (!selectedAnswer) return;

            const question = challengeQuestions[currentQuestion];
            const isCorrect = selectedAnswer === question.answer;
            const player = gameData.player;

            player.total_questions += 1;

            if (isCorrect) {
                player.correct_answers += 1;
                const expGain = question.difficulty * 10;
                const coinGain = question.difficulty * 2;
                player.exp += expGain;
                player.coins += coinGain;
                challengeResults.correct += 1;
            }

            checkLevelUp();
            checkAchievements();

            // é¡¯ç¤ºçµæœ
            const resultContainer = document.getElementById('result-container');
            resultContainer.className = isCorrect 
                ? 'p-4 rounded-lg mb-4 bg-green-50 border border-green-200'
                : 'p-4 rounded-lg mb-4 bg-red-50 border border-red-200';
            
            resultContainer.innerHTML = `
                <p class="font-medium mb-2 ${isCorrect ? 'text-green-800' : 'text-red-800'}">
                    ${isCorrect ? 'âœ… å›ç­”æ­£ç¢ºï¼' : `âŒ å›ç­”éŒ¯èª¤ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ ${question.answer}`}
                </p>
                <p class="text-gray-700">${question.explanation}</p>
            `;
            resultContainer.classList.remove('hidden');

            // æ›´æ–°æŒ‰éˆ•
            document.getElementById('submit-btn').textContent = 
                currentQuestion < challengeQuestions.length - 1 ? 'ä¸‹ä¸€é¡Œ' : 'å®ŒæˆæŒ‘æˆ°';
            document.getElementById('submit-btn').onclick = nextQuestion;

            // ç¦ç”¨é¸é …
            const radios = document.querySelectorAll('input[name="answer"]');
            radios.forEach(radio => radio.disabled = true);

            // æ¨™è¨˜æ­£ç¢ºç­”æ¡ˆ
            const options = document.querySelectorAll('#options-container label');
            options.forEach(option => {
                const radio = option.querySelector('input');
                const span = option.querySelector('span');
                if (radio.value === question.answer) {
                    span.className = 'flex-1 text-green-600 font-medium';
                    const checkmark = document.createElement('span');
                    checkmark.textContent = 'âœ“';
                    checkmark.className = 'text-green-600';
                    option.appendChild(checkmark);
                } else if (radio.value === selectedAnswer && selectedAnswer !== question.answer) {
                    const crossmark = document.createElement('span');
                    crossmark.textContent = 'âœ—';
                    crossmark.className = 'text-red-600';
                    option.appendChild(crossmark);
                }
            });
        }

        // ä¸‹ä¸€é¡Œ
        function nextQuestion() {
            if (currentQuestion < challengeQuestions.length - 1) {
                currentQuestion++;
                selectedAnswer = '';
                displayQuestion();
            } else {
                // æŒ‘æˆ°å®Œæˆ
                const topicId = currentChallenge;
                const topic = gameData.topics[topicId];
                topic.progress = Math.min(topic.progress + challengeResults.correct, topic.total);

                const accuracy = (challengeResults.correct / challengeResults.total) * 100;
                if (accuracy >= 80) {
                    const bonusExp = 50;
                    const bonusCoins = 20;
                    gameData.player.exp += bonusExp;
                    gameData.player.coins += bonusCoins;
                    checkLevelUp();
                    showMessage(`ğŸ‰ å„ªç§€è¡¨ç¾çå‹µï¼š${bonusExp} ç¶“é©—å€¼ï¼Œ${bonusCoins} é‡‘å¹£`);
                }

                showTopics();
            }
        }

        // æ¸²æŸ“å•†åº—
        function renderShop() {
            const grid = document.getElementById('shop-grid');
            grid.innerHTML = '';

            Object.entries(equipmentShop).forEach(([itemName, itemData]) => {
                const owned = gameData.player.equipment[itemName];
                const canAfford = gameData.player.coins >= itemData.price;

                const itemCard = document.createElement('div');
                itemCard.className = 'bg-white border border-gray-200 rounded-lg p-4 shadow-sm card-hover';
                itemCard.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <h3 class="font-medium mb-1">${itemName}</h3>
                            <p class="text-sm text-gray-600 mb-2">${itemData.description}</p>
                            <div class="flex items-center gap-4">
                                <span class="font-bold text-yellow-600">${itemData.price} é‡‘å¹£</span>
                                ${owned ? '<span class="text-green-600 font-medium">âœ… å·²æ“æœ‰</span>' : ''}
                            </div>
                        </div>
                        <button onclick="buyEquipment('${itemName}')" 
                                ${owned || !canAfford ? 'disabled' : ''}
                                class="px-4 py-2 bg-purple-500 hover:bg-purple-600 disabled:bg-gray-300 text-white rounded-lg transition-colors">
                            ${owned ? 'å·²æ“æœ‰' : 'è³¼è²·'}
                        </button>
                    </div>
                `;
                grid.appendChild(itemCard);
            });
        }

        // è³¼è²·è£å‚™
        function buyEquipment(itemName) {
            const itemData = equipmentShop[itemName];
            const player = gameData.player;

            if (player.coins >= itemData.price && !player.equipment[itemName]) {
                player.coins -= itemData.price;
                player.equipment[itemName] = itemData;

                if (itemData.attack) player.attack += itemData.attack;
                if (itemData.defense) player.defense += itemData.defense;
                if (itemData.accuracy) player.accuracy += itemData.accuracy;

                showMessage(`âœ… æˆåŠŸè³¼è²· ${itemName}ï¼`);
                updatePlayerDisplay();
                renderShop();
            } else if (player.equipment[itemName]) {
                showMessage('âŒ ä½ å·²ç¶“æ“æœ‰é€™ä»¶è£å‚™äº†ï¼');
            } else {
                showMessage('âŒ é‡‘å¹£ä¸è¶³ï¼');
            }
        }

        // æ¸²æŸ“æˆå°±
        function renderAchievements() {
            const achievements = gameData.achievements;
            const unlockedCount = Object.values(achievements).filter(a => a.unlocked).length;
            const totalCount = Object.keys(achievements).length;

            document.getElementById('achievement-progress').textContent = `å·²è§£é–ï¼š${unlockedCount}/${totalCount}`;

            const grid = document.getElementById('achievements-grid');
            grid.innerHTML = '';

            Object.entries(achievements).forEach(([name, data]) => {
                const achievementCard = document.createElement('div');
                achievementCard.className = data.unlocked 
                    ? 'border rounded-lg p-4 bg-yellow-50 border-yellow-200'
                    : 'border rounded-lg p-4 bg-gray-50 border-gray-200';
                
                achievementCard.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">${data.unlocked ? 'âœ…' : 'ğŸ”’'}</span>
                            <div>
                                <h3 class="font-medium">${name}</h3>
                                <p class="text-sm text-gray-600">${data.description}</p>
                            </div>
                        </div>
                        <span class="font-bold text-yellow-600">${data.reward} é‡‘å¹£</span>
                    </div>
                `;
                grid.appendChild(achievementCard);
            });
        }

        // æ¸²æŸ“å­¸ç¿’å ±å‘Š
        function renderReport() {
            const player = gameData.player;

            if (player.total_questions > 0) {
                const accuracy = ((player.correct_answers / player.total_questions) * 100).toFixed(1);
                document.getElementById('total-questions').textContent = player.total_questions;
                document.getElementById('correct-answers').textContent = player.correct_answers;
                document.getElementById('accuracy-percentage').textContent = `${accuracy}%`;
            } else {
                document.getElementById('total-questions').textContent = '0';
                document.getElementById('correct-answers').textContent = '0';
                document.getElementById('accuracy-percentage').textContent = '0%';
            }

            // èª²é¡Œé€²åº¦
            const topicProgress = document.getElementById('topic-progress');
            topicProgress.innerHTML = '';

            Object.entries(gameData.topics).forEach(([topicId, topic]) => {
                const percentage = (topic.progress / topic.total) * 100;
                const progressDiv = document.createElement('div');
                progressDiv.innerHTML = `
                    <div class="flex items-center justify-between mb-1">
                        <span class="flex items-center gap-2">
                            <span>${topic.icon}</span>
                            <span class="font-medium">${topic.name}</span>
                        </span>
                        <span class="text-sm text-gray-600">${percentage.toFixed(0)}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-600 h-2 rounded-full progress-bar" style="width: ${percentage}%"></div>
                    </div>
                `;
                topicProgress.appendChild(progressDiv);
            });
        }

        function showSkillTree() {
    hideAllViews();
    document.getElementById('skill-tree-view').classList.remove('hidden');
    renderSkillTree();
}

function renderSkillTree() {
    const grid = document.getElementById('skill-tree-grid');
    grid.innerHTML = '';
    const skills = gameData.player.skills;
    const skillPoints = gameData.player.skill_points;
    Object.entries(skills).forEach(([key, skill]) => {
        const btnDisabled = skill.unlocked || skillPoints < skill.cost;
        const card = document.createElement('div');
        card.className = 'bg-white border rounded-lg p-4 shadow-sm flex items-center justify-between';
        card.innerHTML = `
            <div>
                <div class="text-lg font-bold">${key}</div>
                <div class="text-gray-600">${skill.desc}</div>
            </div>
            <button ${btnDisabled ? 'disabled' : ''} onclick="unlockSkill('${key}')" class="px-4 py-2 rounded bg-green-500 hover:bg-green-600 text-white disabled:bg-gray-300">
                ${skill.unlocked ? 'å·²è§£é–' : `è§£é–(-${skill.cost}é»)`}
            </button>
        `;
        grid.appendChild(card);
    });
    document.getElementById('player-skill-points').textContent = gameData.player.skill_points;
}

function unlockSkill(name) {
    const skills = gameData.player.skills;
    if (!skills[name] || skills[name].unlocked) return;
    if (gameData.player.skill_points < skills[name].cost) return;
    skills[name].unlocked = true;
    gameData.player.skill_points -= skills[name].cost;
    showMessage(`å·²è§£é–æŠ€èƒ½ï¼šã€Œ${name}ã€ï¼`);
    renderSkillTree();
    saveGame();
}
        
        // å•Ÿå‹•éŠæˆ²
        window.onload = initGame;
    </script>
</body>
</html>
